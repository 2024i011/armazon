import React, { useState } from 'react';
import { ShoppingCart, Search, Menu, Star, CreditCard, Smartphone, Mail, AlertTriangle, Lock, ShieldAlert } from 'lucide-react';

export default function App() {
  const [currentView, setCurrentView] = useState('home'); // home, login, payment, result
  const [selectedProduct, setSelectedProduct] = useState(null);
  const [capturedData, setCapturedData] = useState({
    email: '',
    password: '',
    paymentMethod: '',
    cardName: '',
    cardNumber: '',
    cardExp: '',
    cardCvv: '',
    payPayId: '',
    contactEmail: ''
  });

  // モック商品データ
  const products = [
    { id: 1, title: "ワイヤレスイヤホン Pro - ノイズキャンセリング搭載", price: 2980, rating: 4.5, image: "https://placehold.co/200x200/333/fff?text=Earphones" },
    { id: 2, title: "スマートウォッチ Series 7 - 防水・心拍計", price: 4500, rating: 4.0, image: "https://placehold.co/200x200/333/fff?text=SmartWatch" },
    { id: 3, title: "4K ゲーミングモニター 27インチ", price: 24800, rating: 4.8, image: "https://placehold.co/200x200/333/fff?text=Monitor" },
    { id: 4, title: "ポータブル電源 大容量 1000Wh", price: 35000, rating: 4.2, image: "https://placehold.co/200x200/333/fff?text=PowerBank" },
    { id: 5, title: "高級ゲーミングチェア - 人間工学設計", price: 15800, rating: 3.9, image: "https://placehold.co/200x200/333/fff?text=Chair" },
    { id: 6, title: "最新スマートフォン - 256GB SIMフリー", price: 89000, rating: 4.7, image: "https://placehold.co/200x200/333/fff?text=Smartphone" },
  ];

  // 商品クリック時の処理
  const handleProductClick = (product) => {
    setSelectedProduct(product);
    setCurrentView('login'); // 強制的にログイン画面へ
  };

  // ログイン処理
  const handleLoginSubmit = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    setCapturedData(prev => ({
      ...prev,
      email: formData.get('email'),
      password: formData.get('password')
    }));
    setCurrentView('payment'); // 決済画面へ誘導
  };

  // 決済情報の処理
  const handlePaymentSubmit = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    
    // フォームの種類に応じてデータを保存
    const newData = { ...capturedData };
    if (newData.paymentMethod === 'credit') {
      newData.cardName = formData.get('cardName');
      newData.cardNumber = formData.get('cardNumber');
      newData.cardExp = formData.get('cardExp');
      newData.cardCvv = formData.get('cardCvv');
    } else if (newData.paymentMethod === 'paypay') {
      newData.payPayId = formData.get('payPayId');
      newData.password = formData.get('payPayPassword'); // パスワードの上書き（再利用）のシミュレーション
    } else if (newData.paymentMethod === 'email') {
      newData.contactEmail = formData.get('contactEmail');
    }

    setCapturedData(newData);
    setCurrentView('result'); // 詐欺啓発画面へ
  };

  // コンポーネント: ヘッダー（偽装）
  const FakeHeader = () => (
    <div className="bg-gray-900 text-white p-2 flex items-center justify-between px-4 sticky top-0 z-50">
      <div className="flex items-center gap-4">
        <Menu className="w-6 h-6 sm:hidden" />
        <span className="text-2xl font-bold italic tracking-tighter">GigaStore</span>
      </div>
      <div className="hidden sm:flex flex-1 mx-8 bg-white rounded overflow-hidden">
        <input type="text" placeholder="商品を検索..." className="w-full px-4 py-2 text-black outline-none" />
        <button className="bg-orange-400 p-2"><Search className="text-gray-800" /></button>
      </div>
      <div className="flex items-center gap-4 text-sm">
        <div className="hidden sm:block">
          <div className="text-xs text-gray-300">こんにちは</div>
          <div className="font-bold">ログイン</div>
        </div>
        <ShoppingCart className="w-6 h-6" />
      </div>
    </div>
  );

  // コンポーネント: 偽アドレスバー（教育用）
  const FakeUrlBar = () => (
    <div className="bg-gray-100 border-b border-gray-300 p-2 flex items-center justify-center text-xs text-gray-500 font-mono">
      <Lock className="w-3 h-3 mr-1 text-red-500" />
      <span className="text-red-600 font-bold mr-2">▲ 注意: 安全ではありません</span>
      <span>http://amaz0n-security-update-login.xyz/jp/signin</span>
    </div>
  );

  // 画面1: 商品一覧
  if (currentView === 'home') {
    return (
      <div className="min-h-screen bg-gray-100 font-sans">
        <FakeHeader />
        <div className="max-w-6xl mx-auto p-4">
          <div className="mb-6">
            <img src="https://placehold.co/1200x300/232f3e/fff?text=Super+Sale+50%25+OFF" alt="Banner" className="w-full rounded shadow" />
          </div>
          <h2 className="text-xl font-bold mb-4">タイムセール商品</h2>
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {products.map(product => (
              <div 
                key={product.id} 
                className="bg-white p-4 rounded shadow hover:shadow-lg transition cursor-pointer flex flex-col"
                onClick={() => handleProductClick(product)}
              >
                <img src={product.image} alt={product.title} className="w-full h-40 object-contain mb-4" />
                <div className="text-sm text-gray-700 line-clamp-2 mb-1 h-10">{product.title}</div>
                <div className="flex text-yellow-500 text-xs mb-2">
                  {[...Array(5)].map((_, i) => (
                    <Star key={i} size={14} fill={i < Math.floor(product.rating) ? "currentColor" : "none"} />
                  ))}
                  <span className="text-blue-600 ml-1">{product.rating}</span>
                </div>
                <div className="text-lg font-bold text-red-700 mt-auto">¥{product.price.toLocaleString()}</div>
                <button className="mt-2 w-full bg-yellow-400 hover:bg-yellow-500 text-sm py-1 rounded-full shadow-sm">
                  カートに入れる
                </button>
              </div>
            ))}
          </div>
        </div>
        <div className="bg-gray-800 text-gray-400 text-center py-8 text-xs mt-8">
          © 1996-2024, GigaStore.com, Inc. or its affiliates
        </div>
      </div>
    );
  }

  // 画面2: 偽ログイン画面
  if (currentView === 'login') {
    return (
      <div className="min-h-screen bg-white font-sans flex flex-col items-center pt-8 px-4">
         <FakeUrlBar />
        <div className="mb-6 text-3xl font-bold italic tracking-tighter">GigaStore</div>
        
        <div className="w-full max-w-sm border border-gray-300 rounded p-6 shadow-sm">
          <h1 className="text-2xl font-normal mb-4">ログイン</h1>
          {selectedProduct && (
            <div className="mb-4 p-2 bg-yellow-50 border border-yellow-200 text-sm text-yellow-800 rounded">
              購入手続きを進めるにはログインが必要です。
            </div>
          )}
          <form onSubmit={handleLoginSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-bold text-gray-700 mb-1">Eメールまたは携帯電話番号</label>
              <input 
                name="email" 
                type="text" 
                required 
                className="w-full border border-gray-400 rounded px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 outline-none"
              />
            </div>
            <div>
              <div className="flex justify-between">
                <label className="block text-sm font-bold text-gray-700 mb-1">パスワード</label>
                <a href="#" className="text-xs text-blue-600 hover:underline">パスワードを忘れた場合</a>
              </div>
              <input 
                name="password" 
                type="password" 
                required 
                className="w-full border border-gray-400 rounded px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 outline-none"
              />
            </div>
            <button 
              type="submit" 
              className="w-full bg-yellow-400 hover:bg-yellow-500 border border-yellow-600 rounded py-2 text-sm shadow-sm"
            >
              ログイン
            </button>
            <div className="text-xs text-gray-600 mt-4">
              続行することで、GigaStoreの<span className="text-blue-600">利用規約</span>および<span className="text-blue-600">プライバシー規約</span>に同意するものとみなされます。
            </div>
          </form>
        </div>
        
        <div className="my-6 w-full max-w-sm">
          <div className="relative text-center">
            <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-gray-300"></div></div>
            <div className="relative z-10 inline-block bg-white px-2 text-xs text-gray-500">GigaStoreの新しいお客様ですか？</div>
          </div>
          <button className="w-full mt-4 border border-gray-400 bg-gray-50 hover:bg-gray-100 rounded py-2 text-sm shadow-sm">
            GigaStoreアカウントを作成
          </button>
        </div>
      </div>
    );
  }

  // 画面3: 偽決済情報入力画面
  if (currentView === 'payment') {
    return (
      <div className="min-h-screen bg-gray-100 font-sans pb-12">
        <FakeUrlBar />
        <div className="bg-gray-900 text-white p-4 text-center text-xl font-bold italic">GigaStore <span className="text-sm font-normal not-italic ml-2">決済センター</span></div>
        
        <div className="max-w-2xl mx-auto mt-8 p-6 bg-white border border-gray-300 rounded shadow-sm">
          <h2 className="text-xl font-bold text-orange-700 mb-4 border-b pb-2">お支払い方法の確認（必須）</h2>
          
          <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-6 text-sm">
            <div className="font-bold flex items-center gap-2"><AlertTriangle size={16}/> 重要なお知らせ</div>
            セキュリティ上の理由により、再度お支払い情報の確認が必要です。確認が完了しない場合、アカウントがロックされる可能性があります。
          </div>

          <div className="space-y-4">
            {/* 支払い方法選択ボタン */}
            <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6">
              <button 
                onClick={() => setCapturedData({...capturedData, paymentMethod: 'credit'})}
                className={`p-3 border rounded flex items-center justify-center gap-2 ${capturedData.paymentMethod === 'credit' ? 'bg-orange-50 border-orange-500 ring-2 ring-orange-200' : 'hover:bg-gray-50'}`}
              >
                <CreditCard size={20} />
                <span className="text-sm font-bold">カード</span>
              </button>
              <button 
                onClick={() => setCapturedData({...capturedData, paymentMethod: 'paypay'})}
                className={`p-3 border rounded flex items-center justify-center gap-2 ${capturedData.paymentMethod === 'paypay' ? 'bg-red-50 border-red-500 ring-2 ring-red-200' : 'hover:bg-gray-50'}`}
              >
                <Smartphone size={20} />
                <span className="text-sm font-bold">QR決済</span>
              </button>
              <button 
                onClick={() => setCapturedData({...capturedData, paymentMethod: 'email'})}
                className={`p-3 border rounded flex items-center justify-center gap-2 ${capturedData.paymentMethod === 'email' ? 'bg-blue-50 border-blue-500 ring-2 ring-blue-200' : 'hover:bg-gray-50'}`}
              >
                <Mail size={20} />
                <span className="text-sm font-bold">その他連携</span>
              </button>
            </div>

            {/* クレジットカードフォーム */}
            {capturedData.paymentMethod === 'credit' && (
              <form onSubmit={handlePaymentSubmit} className="space-y-4 animate-in fade-in slide-in-from-top-4 duration-300">
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-1">カード名義人</label>
                  <input name="cardName" required placeholder="TARO YAMADA" className="w-full border rounded p-2" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-1">カード番号</label>
                  <input name="cardNumber" required placeholder="0000 0000 0000 0000" maxLength="19" className="w-full border rounded p-2" />
                </div>
                <div className="flex gap-4">
                  <div className="flex-1">
                    <label className="block text-sm font-bold text-gray-700 mb-1">有効期限</label>
                    <input name="cardExp" required placeholder="MM/YY" maxLength="5" className="w-full border rounded p-2" />
                  </div>
                  <div className="flex-1">
                    <label className="block text-sm font-bold text-gray-700 mb-1">セキュリティコード</label>
                    <input name="cardCvv" required placeholder="123" maxLength="4" className="w-full border rounded p-2" />
                  </div>
                </div>
                <button type="submit" className="w-full bg-yellow-400 hover:bg-yellow-500 font-bold py-2 rounded shadow text-sm">カード情報を更新して注文を確定</button>
              </form>
            )}

            {/* PayPay風フォーム */}
            {capturedData.paymentMethod === 'paypay' && (
              <form onSubmit={handlePaymentSubmit} className="space-y-4 animate-in fade-in slide-in-from-top-4 duration-300 p-4 bg-gray-50 rounded">
                <div className="text-center font-bold text-red-600 mb-2">アカウント連携ログイン</div>
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-1">携帯電話番号 / ID</label>
                  <input name="payPayId" required className="w-full border rounded p-2" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-1">パスワード</label>
                  <input name="payPayPassword" type="password" required className="w-full border rounded p-2" />
                </div>
                <button type="submit" className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded shadow text-sm">連携して支払う</button>
              </form>
            )}

            {/* メール連携フォーム */}
            {capturedData.paymentMethod === 'email' && (
              <form onSubmit={handlePaymentSubmit} className="space-y-4 animate-in fade-in slide-in-from-top-4 duration-300 p-4 bg-gray-50 rounded">
                 <div className="text-center font-bold text-blue-600 mb-2">キャリアメール連携</div>
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-1">メールアドレス</label>
                  <input name="contactEmail" type="email" required className="w-full border rounded p-2" />
                </div>
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-1">メールパスワード</label>
                  <input name="emailPassword" type="password" required className="w-full border rounded p-2" />
                </div>
                <button type="submit" className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded shadow text-sm">認証して進む</button>
              </form>
            )}
            
            {!capturedData.paymentMethod && (
              <div className="text-center text-gray-500 py-8">
                お支払い方法を選択してください
              </div>
            )}

          </div>
        </div>
      </div>
    );
  }

  // 画面4: ネタばらし（教育用結果画面）
  if (currentView === 'result') {
    return (
      <div className="min-h-screen bg-red-900 text-white p-4 font-sans flex flex-col items-center justify-center">
        <div className="max-w-2xl w-full bg-white text-gray-800 rounded-lg shadow-2xl overflow-hidden">
          <div className="bg-red-600 p-6 text-center">
            <ShieldAlert className="w-16 h-16 mx-auto text-white mb-4" />
            <h1 className="text-3xl font-bold text-white mb-2">詐欺シミュレーション終了</h1>
            <p className="text-red-100">※これは教育用の訓練プログラムです。実際の被害はありません。</p>
          </div>
          
          <div className="p-8">
            <h2 className="text-xl font-bold text-center mb-6">もしこれが本物の詐欺サイトだったら...<br/>あなたの以下の情報は全て盗まれていました。</h2>
            
            <div className="bg-gray-100 p-4 rounded-lg font-mono text-sm border-l-4 border-red-500 mb-8 overflow-x-auto">
              <div className="mb-2"><span className="text-gray-500">ID/Email:</span> <span className="font-bold text-red-600">{capturedData.email}</span></div>
              <div className="mb-2"><span className="text-gray-500">Password:</span> <span className="font-bold text-red-600">{capturedData.password}</span></div>
              <div className="border-t border-gray-300 my-2 pt-2"></div>
              {capturedData.paymentMethod === 'credit' && (
                <>
                  <div className="mb-1"><span className="text-gray-500">Card Name:</span> {capturedData.cardName}</div>
                  <div className="mb-1"><span className="text-gray-500">Card Number:</span> {capturedData.cardNumber}</div>
                  <div className="mb-1"><span className="text-gray-500">Exp/CVV:</span> {capturedData.cardExp} / {capturedData.cardCvv}</div>
                </>
              )}
              {capturedData.paymentMethod === 'paypay' && (
                <>
                  <div className="mb-1"><span className="text-gray-500">QR ID:</span> {capturedData.payPayId}</div>
                  <div className="mb-1"><span className="text-gray-500">Password:</span> {capturedData.password}</div>
                </>
              )}
               {capturedData.paymentMethod === 'email' && (
                <>
                  <div className="mb-1"><span className="text-gray-500">Contact Email:</span> {capturedData.contactEmail}</div>
                </>
              )}
            </div>

            <div className="space-y-4">
              <h3 className="text-lg font-bold flex items-center gap-2"><Search className="w-5 h-5" /> 騙されないためのチェックポイント</h3>
              <ul className="list-disc list-inside space-y-2 text-sm text-gray-700">
                <li>
                  <span className="font-bold text-red-600">URLを確認しましたか？</span>
                  <br/>本物のサイト（例: amazon.co.jp）と微妙に違うURL（amaz0n.xyzなど）になっていませんでしたか？
                </li>
                <li>
                  <span className="font-bold text-red-600">不自然なログイン要求</span>
                  <br/>商品を見るだけ、あるいは購入ボタンを押した直後に、理由もなく「セキュリティ上の理由」などで個人情報の再入力を求められるのは詐欺の常套手段です。
                </li>
                <li>
                  <span className="font-bold text-red-600">急かすような警告文</span>
                  <br/>「アカウントがロックされます」「支払いが完了していません」など、不安を煽って判断力を奪おうとしていませんでしたか？
                </li>
              </ul>
            </div>

            <button 
              onClick={() => {
                setCapturedData({});
                setCurrentView('home');
              }}
              className="mt-8 w-full bg-gray-800 text-white py-3 rounded hover:bg-gray-700 transition"
            >
              シミュレーションを終了してトップへ戻る
            </button>
          </div>
        </div>
      </div>
    );
  }

  return null;
}